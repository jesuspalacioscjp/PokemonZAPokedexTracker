<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Z-A Pokedex Tracker V6</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@400;700&display=swap');

        /* --- ESTILOS VISUALES --- */
        body {
            font-family: 'Roboto Condensed', sans-serif;
            background-color: #222; /* Fondo gris oscuro */
            color: #fff;            /* Texto blanco */
            margin: 0;
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
        }

        h1 { margin: 10px 0; color: #ffcb05; text-align: center; font-size: 1.5rem; text-shadow: 2px 2px #000; }
        
        #loading-msg {
            color: white;
            font-size: 1.2rem;
            margin-top: 50px;
            text-align: center;
        }

        /* HOJA DE LA POKEDEX */
        .sheet {
            background: white;
            width: 95%;           /* 95% del ancho de la pantalla */
            max-width: 800px;     /* Tope para PC */
            margin-bottom: 20px;
            display: flex;
            flex-direction: column;
            /* Si aspect-ratio falla, usa altura mínima */
            min-height: 300px;
            aspect-ratio: 31 / 26;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            position: relative;
        }

        /* ENCABEZADO DE CAJA */
        .box-header {
            width: 100%;
            height: 10%;          /* Un poco más alto para que sea legible en movil */
            max-height: 40px;     /* Tope en PC */
            background-color: #444;
            color: white;
            display: flex;
            align-items: center;
            padding-left: 10px;
            font-weight: bold;
            font-size: 1.2rem;
            box-sizing: border-box;
            border-bottom: 2px solid #222;
        }

        /* REJILLA DE POKEMON */
        .box-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            grid-template-rows: repeat(5, 1fr);
            width: 100%;
            height: 90%; /* El resto de la altura */
            flex-grow: 1;
        }

        .box {
            border: 1px solid #ddd;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            background: #fff;
            overflow: hidden;
            color: #333; /* Texto negro dentro de la caja blanca */
        }

        .box-num {
            position: absolute;
            top: 2px;
            left: 3px;
            color: #999;
            font-weight: bold;
            font-size: 0.7rem;
        }

        /* CONTENEDOR DE IMAGEN */
        .img-placeholder {
            width: 80%;
            height: 80%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .poke-img {
            max-width: 100%;
            max-height: 100%;
            filter: grayscale(100%) opacity(0.6); 
            transition: all 0.2s;
        }

        .box-name {
            position: absolute;
            bottom: 1px;
            width: 100%;
            text-align: center;
            font-weight: 700;
            text-transform: uppercase;
            color: #333;
            font-size: 0.6rem;
            line-height: 1;
        }

        /* ESTADO ATRAPADO */
        .box.caught { background-color: #ccfbf1; }
        .box.caught .poke-img { filter: grayscale(0%) opacity(1); transform: scale(1.15); }
        .box.caught .box-num { color: #0f766e; }
        .box.caught .box-name { color: #000; font-weight: 900; }

        /* IMPRESION */
        @media print {
            @page { size: 31cm 26cm; margin: 0; }
            body { background: white; display: block; padding: 0; }
            .no-print, h1, #loading-msg { display: none !important; }
            
            .sheet {
                width: 31cm !important;
                height: 26cm !important;
                max-width: none !important;
                aspect-ratio: auto !important;
                page-break-after: always;
                margin: 0 !important;
                box-shadow: none;
            }
            .box-header { height: 1cm !important; max-height: none !important; font-size: 16px !important; }
            .box-grid { grid-template-columns: repeat(6, 5cm) !important; grid-template-rows: repeat(5, 5cm) !important; height: 25cm !important; }
            .box { width: 5cm !important; height: 5cm !important; border: 1px solid #ccc !important; }
            .img-placeholder { width: 4cm !important; height: 4cm !important; }
            .box-num { font-size: 10px !important; }
            .box-name { font-size: 11px !important; }
        }
        
        .btn-reset {
            padding: 12px 24px;
            background-color: #ef4444;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            margin: 20px 0 40px 0;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <div class="no-print">
        <h1>Tracker Z-A</h1>
        <p style="text-align:center; color:#bbb; font-size:0.9rem;">
            Toca una casilla para marcar/desmarcar.<br>
            Optimizado para Celular e Impresión (31x26cm).
        </p>
    </div>

    <div id="loading-msg">Cargando datos de la Pokédex...<br><small>Si esto no desaparece, hay un error en el script.</small></div>

    <div id="pokedex-container"></div>

    <div class="no-print">
        <button class="btn-reset" onclick="resetProgress()">Borrar todo el progreso</button>
    </div>

    <script>
    // Usamos un bloque try-catch global para evitar pantalla negra
    try {
        /* LISTA DE DATOS */
        const rawData = `
1	Chikorita
2	Bayleef
3	Meganium
4	Tepig
5	Pignite
6	Emboar
7	Totodile
8	Croconaw
9	Feraligatr
10	Fletchling
11	Fletchinder
12	Talonflame
13	Bunnelby
14	Diggersby
15	Scatterbug
16	Spewpa
17	Vivillon
18	Weedle
19	Kakuna
20	Beedrill
21	Pidgey
22	Pidgeotto
23	Pidgeot
24	Mareep
25	Flaaffy
26	Ampharos
27	Patrat
28	Watchog
29	Budew
30	Roselia
31	Roserade
32	Magikarp
33	Gyarados
34	Binacle
35	Barbaracle
36	Staryu
37	Starmie
38	Flabébé
39	Floette
40	Florges
41	Skiddo
42	Gogoat
43	Espurr
44	Meowstic
45	Litleo
46	Pyroar
47	Pancham
48	Pangoro
49	Trubbish
50	Garbodor
51	Dedenne
52	Pichu
53	Pikachu
54	Raichu
55	Cleffa
56	Clefairy
57	Clefable
58	Spinarak
59	Ariados
60	Ekans
61	Arbok
62	Abra
63	Kadabra
64	Alakazam
65	Gastly
66	Haunter
67	Gengar
68	Venipede
69	Whirlipede
70	Scolipede
71	Honedge
72	Doublade
73	Aegislash
74	Bellsprout
75	Weepinbell
76	Victreebel
77	Pansage
78	Simisage
79	Pansear
80	Simisear
81	Panpour
82	Simipour
83	Meditite
84	Medicham
85	Electrike
86	Manectric
87	Ralts
88	Kirlia
89	Gardevoir
90	Gallade
91	Houndour
92	Houndoom
93	Swablu
94	Altaria
95	Audino
96	Spritzee
97	Aromatisse
98	Swirlix
99	Slurpuff
100	Eevee
101	Vaporeon
102	Jolteon
103	Flareon
104	Espeon
105	Umbreon
106	Leafeon
107	Glaceon
108	Sylveon
109	Buneary
110	Lopunny
111	Shuppet
112	Banette
113	Vanillite
114	Vanillish
115	Vanilluxe
116	Numel
117	Camerupt
118	Hippopotas
119	Hippowdon
120	Drilbur
121	Excadrill
122	Sandile
123	Krokorok
124	Krookodile
125	Machop
126	Machoke
127	Machamp
128	Gible
129	Gabite
130	Garchomp
131	Carbink
132	Sableye
133	Mawile
134	Absol
135	Riolu
136	Lucario
137	Slowpoke
138	Slowbro
139	Slowking
140	Carvanha
141	Sharpedo
142	Tynamo
143	Eelektrik
144	Eelektross
145	Dratini
146	Dragonair
147	Dragonite
148	Bulbasaur
149	Ivysaur
150	Venusaur
151	Charmander
152	Charmeleon
153	Charizard
154	Squirtle
155	Wartortle
156	Blastoise
157	Stunfisk
158	Furfrou
159	Inkay
160	Malamar
161	Skrelp
162	Dragalge
163	Clauncher
164	Clawitzer
165	Goomy
166	Sliggoo
167	Goodra
168	Delibird
169	Snorunt
170	Glalie
171	Froslass
172	Snover
173	Abomasnow
174	Bergmite
175	Avalugg
176	Scyther
177	Scizor
178	Pinsir
179	Heracross
180	Emolga
181	Hawlucha
182	Phantump
183	Trevenant
184	Scraggy
185	Scrafty
186	Noibat
187	Noivern
188	Klefki
189	Litwick
190	Lampent
191	Chandelure
192	Aerodactyl
193	Tyrunt
194	Tyrantrum
195	Amaura
196	Aurorus
197	Onix
198	Steelix
199	Aron
200	Lairon
201	Aggron
202	Helioptile
203	Heliolisk
204	Pumpkaboo
205	Gourgeist
206	Larvitar
207	Pupitar
208	Tyranitar
209	Froakie
210	Frogadier
211	Greninja
212	Falinks
213	Chespin
214	Quilladin
215	Chesnaught
216	Skarmory
217	Fennekin
218	Braixen
219	Delphox
220	Bagon
221	Shelgon
222	Salamence
223	Kangaskhan
224	Drampa
225	Beldum
226	Metang
227	Metagross
228	Xerneas
229	Yveltal
230	Zygarde
231	Diancie
232	Mewtwo
`;

        /* --- LÓGICA SEGURA --- */
        const container = document.getElementById('pokedex-container');
        const loadingMsg = document.getElementById('loading-msg');
        
        // Función segura para leer almacenamiento (evita crash en incógnito)
        function getSafeStorage() {
            try {
                return JSON.parse(localStorage.getItem('za_pokedex_caught')) || [];
            } catch (e) {
                console.warn("No se pudo acceder al almacenamiento local (¿Modo incógnito?)");
                return [];
            }
        }

        function setSafeStorage(data) {
            try {
                localStorage.setItem('za_pokedex_caught', JSON.stringify(data));
            } catch (e) {
                console.warn("No se pudo guardar el progreso.");
            }
        }

        let caughtPokemon = getSafeStorage();

        function formatNameForUrl(name) {
            return name.toLowerCase()
                       .replace(/\./g, '')       
                       .replace(/\s+/g, '-')     
                       .replace(/é/g, 'e')       
                       .replace(/♀/g, '-f')      
                       .replace(/♂/g, '-m')
                       .replace(/'/g, '');       
        }

        // Esta función se llama al hacer clic
        window.toggleCaught = function(id) {
            const index = caughtPokemon.indexOf(id);
            const box = document.getElementById(`box-${id}`);
            
            if (index === -1) {
                caughtPokemon.push(id);
                box.classList.add('caught');
            } else {
                caughtPokemon.splice(index, 1);
                box.classList.remove('caught');
            }
            setSafeStorage(caughtPokemon);
        }

        window.resetProgress = function() {
            if(confirm("¿Borrar todo el progreso?")) {
                try { localStorage.removeItem('za_pokedex_caught'); } catch(e){}
                location.reload();
            }
        }

        // GENERACIÓN DE LA INTERFAZ
        const lines = rawData.trim().split('\n');
        const itemsPerPage = 30; 
        const totalPages = Math.ceil(lines.length / itemsPerPage);

        for (let i = 0; i < totalPages; i++) {
            const sheet = document.createElement('div');
            sheet.className = 'sheet';

            // HEADER
            const header = document.createElement('div');
            header.className = 'box-header';
            header.innerHTML = `<span>CAJA ${String(i + 1).padStart(2, '0')}</span>`;
            sheet.appendChild(header);

            // GRID
            const grid = document.createElement('div');
            grid.className = 'box-grid';

            for (let j = 0; j < itemsPerPage; j++) {
                const currentIndex = (i * itemsPerPage) + j;
                const box = document.createElement('div');
                box.className = 'box';

                if (currentIndex < lines.length) {
                    const parts = lines[currentIndex].trim().split(/\s+(.+)/);
                    if(parts.length >= 2){
                        const id = parts[0];
                        const name = parts[1];
                        const cleanName = formatNameForUrl(name);
                        const imgUrl = `https://img.pokemondb.net/sprites/home/normal/${cleanName}.png`;

                        box.id = `box-${id}`;
                        // Usamos onclick inline para asegurar funcionalidad
                        box.setAttribute('onclick', `toggleCaught('${id}')`);

                        if (caughtPokemon.includes(id)) box.classList.add('caught');

                        box.innerHTML = `
                            <span class="box-num">#${id}</span>
                            <div class="img-placeholder">
                                <img src="${imgUrl}" class="poke-img" loading="lazy" alt="" onerror="this.style.display='none'">
                            </div>
                            <span class="box-name">${name}</span>
                        `;
                    }
                } else {
                    box.style.background = "#f9f9f9";
                    box.style.cursor = "default";
                }
                grid.appendChild(box);
            }
            sheet.appendChild(grid);
            container.appendChild(sheet);
        }
        
        // Si todo salió bien, ocultamos mensaje de carga
        loadingMsg.style.display = 'none';

    } catch (error) {
        console.error("Error crítico:", error);
        document.getElementById('loading-msg').innerHTML = "ERROR: " + error.message;
    }
    </script>
</body>
</html>